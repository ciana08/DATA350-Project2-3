---
title: "Investigating Health and Lifestyle Variables in the NHANESraw Dataset"
author: "Sofya Kozhukhova, Ciana Gomes, Joshua Hildebrand"
output: html_document
date: "2025-10-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r}
library(NHANES)
library(ggcorrplot)
library(ggplot2)
library(dplyr)
library(tidyverse)
```
- This report explores patterns in health, lifestyle, and demographic variables using data from the 2011–2012 NHANESraw dataset, focusing on adults aged 18 and older. We looked at several key relationships, including how alcohol consumption differs by marital status and race, how testosterone levels vary with age and BMI, and whether poverty ratio is associated with cholesterol across racial groups. We also explored how the age at which individuals began smoking or using marijuana relates to education level, and whether sleep duration, mental health, screen time, and physical activity show any connected patterns. Overall, this exploratory data analysis (EDA) aims to provide insight into how lifestyle factors, socioeconomic status, and demographics intersect with health outcomes. Although we didn’t begin with a specific theme in mind, our goal was to explore how different lifestyle, demographic, and social factors might relate to health outcomes. We recognize that because the majority of this dataset is self-reported, it is vulnerable to bias (especially for variables like substance use). While we plan to focus on a narrower range of exploration topics in future projects, for this analysis, we chose to explore multiple aspects of the dataset to gain a broad understanding of the variables and their relationships. 

## 1. How does AlcoholDay compare between Married and Divorced marital status groups across Race3

- To analyze the relationship between marital status and alcohol consumption, we filtered the dataset to include only participants aged 20 and older from the 2011–2012 survey cycle. We then mutated the MaritalStatus variable to create MaritalStatus2. This new variable grouped the marriage statuses “NeverMarried”, “LivePartner” and “Divorced” into “Not Married”. Although the marriage status “Widowed” could technically be included in the “Not Married” variable,  it was excluded due to its distinct demographic characteristics which could confound the analysis. Because widowed individuals tend to differ substantially in age, life stage, and social context from those who are single, divorced, or cohabiting, including them in the “Not Married” category could obscure meaningful differences in drinking behavior by introducing potential exogenous variables (i.e. loneliness, grief). However, further analysis could be conducted to assess how including the “Widowed” category might affect the KDE distributions and whether its inclusion yields meaningful differences across racial groups. The “Married” category of MaritalStatus2 included only the “Married” variable. As a result, the “Married” and “Not Married” categories of MaritalStatus2 consisted of 1,894 and 1,656 participants, respectively. The reason for using Race3 as the race variable instead of Race1 was because it included an “Asian” category. 

```{r, fig.width = 8}
nhanes_5 <- NHANESraw |>
  filter(SurveyYr == "2011_12" & Age >= 20)|>
  mutate(MaritalStatus2 = case_when(
    MaritalStatus %in% c("NeverMarried", "Divorced","LivePartner") ~ "Not Married",
    MaritalStatus %in% c("Married") ~ "Married"),
    MaritalStatus2 = factor(MaritalStatus2, levels = c("Married", "Not Married")))|>
  mutate(LogAlc = log(AlcoholYear))|>
  filter(!is.na(MaritalStatus2), 
         !is.na(Race3),
         !is.na(LogAlc))|>
  select(MaritalStatus2, Race3, LogAlc, AlcoholYear)

ggplot(nhanes_5,aes(x = LogAlc, fill = MaritalStatus2)) +
  geom_density(alpha = 0.3) +
  facet_wrap(~Race3) + 
  labs(title = "Distribution of Estimated Number of Days in the Past Year Participants Drank
       Alcohol by Race and Marriage Status", 
       x = "Estimated Number of Days Drinking (log)", 
       y = "Density", fill = "Marital Status",
       caption = str_wrap("This graph shows the KDE plots of the log-transformed self-reported amount of alcoholic beverages consumed in the past year for participants across the Race 3 variable for the 2011-2012 survey year. Log transformation was applied to normalize the distribution and improve visual clarity by reducing the influence of outliers. Marital status is split into two variables: 'Married' and 'Not Married'. The 'Asian', 'Mexican' and 'Other' racial group distributions resemble bimodal distributions, while 'Hispanic', 'White' and 'Black' racial groups are multimodal. Source: NHANESraw dataset", width = 100)) +  
  theme_bw()
```

- To visualize the distributions of days per year drinking between the two marital status groups by race, we used six kernel density plots (one for each race category). By examining separate kernel density plots, we could identify differences in distributional patterns, such as skewness, variability, or the presence of multiple modes. We log-transformed the AlcoholYear variable to correct for right skewness and improve the interpretability of the density plots. When creating the KDE plots, we log-transformed the AlcoholYear data because it was a non-normal distribution that was skewed to the right. This transformation reduces skewness, allowing for a more symmetric distribution and improving the interpretability and comparability of the density estimates across groups. The distributions for "Asian", "Mexican", and "Other" participants exhibited bimodal patterns, whereas those for the "Black", "White", and "Hispanic" groups largely overlapped.

```{r, fig.width = 8}
# Calculate summary statistics
library(knitr)
library(kableExtra)
summary_stats<-nhanes_5 |>
  group_by(Race3, MaritalStatus2) |>
  summarise(
    mean_days = mean(AlcoholYear),
    median_days = median(AlcoholYear),
    se = sd(AlcoholYear) / sqrt(n()),
    LCI = mean_days - se,
    UCI = mean_days + se,
  )

# Plot means with error bars
ggplot(summary_stats, aes(x = Race3, y = mean_days, fill = MaritalStatus2)) +
  geom_col(position = position_dodge(0.9), alpha = 0.7) +
  geom_errorbar(aes(ymin = LCI, ymax = UCI),
                position = position_dodge(0.8), width = 0.2) +
  geom_point(aes(y = median_days, shape = MaritalStatus2), 
             position = position_dodge(0.8), size = 2, color = "black") +
  labs(title = "Mean vs Median Number of Days Consuming Alcoholic Beverages in the Past Year",
       x = "Race", y = "Drinking Days per Year", fill = "Drinking Days Per Year (Mean)", shape = "Drinking Days Per Year (Median)", 
       caption = str_wrap("This graph compares the means and medians of the self-reported number of alcoholic beverages consumed in the past year across the Race3 variable. The bars show means (with 95% CIs) and the shapes show medians for drinking days per year. The 'White' race category exhibits nearly identical median drinking days despite differences in the mean, whereas the 'Other' category shows substantial variation in both the mean and median, with differences in the median being significantly higher. Source: NHANESraw dataset"), width = 200)+
  guides(fill = guide_legend(override.aes = list(shape = NA))) +
  theme(plot.title = element_text(hjust = 0.2))+
  theme_bw()
summary_table <- summary_stats |>
  select(Race3, MaritalStatus2, mean_days, median_days, se, LCI, UCI) |>
  kable(digits = 2, 
        col.names = c("Race", "Marital Status", "Mean", "Median", "SE", "Lower CI", "Upper CI"),
        caption = "Summary Statistics for Alcohol Consumption Days")
summary_table
```

- Because log-transformed KDE plots do not convey specific numerical values such as means or medians, we also created a bar plot with error bars to better visualize the central tendencies and variability of drinking frequency by marital status across race groups. We calculated the mean, median, and 95% confidence intervals of the data, grouped by race and marital status. Because most participants reported drinking on the lower end of the 365-day range, the means were disproportionately influenced by a small number of heavy drinkers. As a result, there was a substantial gap between the mean and median values. This pattern is clearly visible in the graph, where median drinking days for each racial group do not exceed 24 days per year, while mean values reach as high as ~87 days per year due to the mean’s sensitivity to outliers. Interestingly, the median number of drinking days for "White" participants was 24 in both marital status groups, while for "Hispanic" participants it was 12 in both. For all other racial groups, the median reported drinking days were noticeably higher for the Not Married category. “Other” had the lowest median drinking days for the Married category at only 3 drinks. Mean drinking days for the “Asian”, “Black”, “Hispanic”, and “Other” racial groups were higher for the Not Married category, while being the same for each status at ~45 drinks for the Mexican category. Interestingly, the “White” category was the only racial group that had higher average drinking days for “Married” compared to Not Married. These results show the sensitivity of mean and median to outliers and underscore the importance of log-transforming the data to visualize distribution in the KDE plots. 

```{r, fig.width = 8}
pie<- nhanes_5|>
  count(Race3,MaritalStatus2, name = "count")|>
  group_by(Race3)|>
  mutate(percentage = round(count / sum(count)*100, digits = 1))|>
  ungroup()
ggplot(pie, aes(x = "", y = count, fill = MaritalStatus2)) + 
    geom_bar(stat = "identity", position = position_fill(), 
             width = 1, color = "white") +
    geom_text(aes(label = count), position = position_fill(vjust = 0.5), size = 3.5) +
    geom_text(aes(label = paste0("\n","\n","(",percentage,"%)")), position = position_fill(vjust = 0.5), size = 2.4)+
    coord_polar("y", start = 0)+
    facet_wrap(~ Race3)+labs(title = "Marital Status by Race", 
                             fill = "Marital Status", 
                             caption = str_wrap("This is a faceted pie chart showing the distribution of marital status across the Race3 variable. Each pie represents one race category, with slices corresponding to one of two marital status groups: 
                                                'Married' and 'Not Married'. The size of each slice reflects the proportion of individuals within that race who fall into each marital status category, with counts both the number of participants in each group and the percentage of the whole. The 'Other' race category has the fewest participants, with only 119 responses. The 'White' race category has the highest ratio of 'Married' to 'Not Married', while 'Black' has the lowest. Source: NHANESraw dataset", width = 100))+ 
  theme(plot.title = element_text(hjust = 0.5))+
  theme_void()+theme(plot.title = element_text(hjust = 0.5))
```

- We also visualized the distribution of marital status across racial groups using faceted pie charts. Each chart represents one race category from the NHANES dataset, with slices corresponding to "Married" and "Not Married" participants. The size of each slice reflects the relative proportion of individuals within that race who fall into each marital status group. This visualization helps compare how marriage rates differ across races – for example, showing that “White” participants have the highest proportion of married individuals, while “Black” participants have the lowest. 

## 2. What is the distribution of testosterone in the data set over age and how does it vary across BMI groups?

## Testosterone by Age Across BMI WHO Groups for Males

-   Testosterone variable is total testosterone in nanograms per deciliter for participants aged 6 years or older for the years 2011-2012.
-   Age is the age of the participant in 2011-2012, subjects who were 80 years or older were recorded as 80
-   BMI WHO is the body mass index as categorized by the World Health Organization as 12.0-18.4 (underweight), 18.5-24.9 (normal weight), 25-29.9 (overweight), and 30 plus (Obese).

```{r}
NHANES_t <- NHANESraw |>
  select('Testosterone', 'Age', 'Gender','BMI_WHO') |>
  mutate(BMI_WHO = case_when(
    BMI_WHO == '12.0_18.5' ~ 'Underweight',
    BMI_WHO == '18.5_to_24.9' ~ 'Normal Weight',
    BMI_WHO == '25.0_to_29.9' ~ 'Overweight',
    BMI_WHO == '30.0_plus' ~ 'Obese'
  ))

NHANES_t |>
  filter(Gender == 'male') |>
  drop_na(BMI_WHO)|>
  ggplot(aes(x = Age, y = Testosterone)) +
  geom_point(aes(col = BMI_WHO), size = 0.65)+
  facet_wrap(~BMI_WHO) +
  labs(title = 'Testosterone vs Age', y = 'Testosterone (ng/dL)',
       col = 'BMI WHO', caption = 'Source: NHANESraw dataset') + 
  theme_bw()
```

-   Since the distributions are not normal, robust statistics are appropriate for better understanding the distributions.
  - Median and interquartile range are used to accurately compare the spread of testosterone data by age group overtime.

## Median Testosterone by Age Across BMI WHO groups.

```{r}
NHANES_t2 <- NHANES_t |>
  filter(Gender == 'male')|>
  drop_na(BMI_WHO, Testosterone)|>
  mutate(age_group = case_when(
    Age <= 20 ~ '06-20',
    Age <= 40 ~ '21-40',
    Age <= 60 ~ '41-60',
    Age <= 80 ~ '61-80'
  ))|>
  group_by(age_group, BMI_WHO) |> 
  summarize(medT = median(Testosterone), Q1 = quantile(Testosterone, 0.25), Q3 = quantile(Testosterone, 0.75))

ggplot(NHANES_t2, aes(x = age_group, y = medT))+
  geom_bar(aes(fill = BMI_WHO), stat = 'identity', position = 'dodge') + 
  geom_errorbar(aes(ymin = Q1, ymax = Q3, group = BMI_WHO),
                position=position_dodge(0.9))+
  geom_point(aes(group = BMI_WHO), position = position_dodge(0.9))+
  labs(title = 'Testosterone vs Age Group',
       y = 'Median Testosterone', x = 'Age Group',fill = 'BMI WHO',
       caption = 'Source: NHANESraw Dataset, Error Bar: First Quartile, Median, Third Quartile') + 
  theme_bw()

```
- Age is grouped into approximately twenty year increments starting at the first age recorded for testosterone which is six years

## 3. How does poverty ratio relate to BMI and cholesterol levels across races?
```{r}
# Filter to adults in 2011_12 with complete data for variables of interest.
nhanes_clean <- NHANESraw |> 
  filter(SurveyYr == "2011_12", Age >= 18) |> 
  select(ID, Race3, Poverty, BMI, TotChol) |> 
  na.omit()
```

```{r, fig.width=8}
## Poverty vs BMI faceted by Race
ggplot(nhanes_clean, aes(x = Poverty, y = BMI)) +
  geom_point(alpha = 0.5, aes(color = Race3), size = 0.6) +
  geom_smooth(se = TRUE, color = "black") +
  facet_wrap(~ Race3) +
  labs(title = "Relationship Between Poverty Ratio and BMI Across Race",
    x = "Poverty Ratio", y = "Body Mass Index (BMI)", color = "Race Category", 
    caption = str_wrap("Source: NHANESraw 2011–2012 (adults 18+). This plot shows how poverty ratio (income relative to the poverty line) relates to BMI across racial groups. Most participants fall between poverty ratios of 0–2 and BMI values of 20–40. Trend lines are mostly flat, showing little association between income and BMI. The confidence intervals are narrow for most groups, indicating consistent patterns, but noticeably wider for the “Other” category due to smaller sample size.", width=100)
  ) 
```

```{r, fig.width=8}
## Poverty vs Cholesterol faceted by Race
ggplot(nhanes_clean, aes(x = Race3, y = TotChol, color = Race3)) +
  geom_jitter(alpha = 0.3, width = 0.2, size = 0.6) +
  geom_boxplot(alpha = 0.4, outlier.shape = NA) +
  labs(
    title = "Total Cholesterol by Race and Poverty Ratio Groups",
    x = "Race Category", y = "Total Cholesterol (mmol/L)", color = "Race Category", 
       caption = str_wrap("Source: NHANESraw 2011–2012 (adults 18+). Distribution of total cholesterol (mmol/L) across racial groups. Values cluster around 5 mmol/L, with small variations in median and spread. White and Black groups have denser samples, while Hispanic participants show greater variability.", width=110)
  )
```

- To analyze the relationship between poverty and health outcomes, we filtered the data to include only adults (age 18+) with complete data on race, poverty ratio, BMI and cholesterol. BMI and cholesterol are key indicators of overall health that can reflect how socioeconomic factors can influence physical health across populations. Since there were two continuous variables, a scatter plot with a smoothing line, faceted by race, was used to visualize the relationship to show whether BMI trends differ across racial groups and whether poverty predicts BMI. From the plot, most participants cluster around a poverty ratio between 0–2 and BMI values between 20–40. The trend lines are relatively flat, suggesting no strong overall correlation between income and BMI. Most groups stayed relatively consistent around a BMI of 30, while the Mexican group stayed consistent around a BMI of 25. The Other category shows more fluctuation and higher degree of uncertainty according to the confidence interval. For the cholesterol plot, a jitter plot overlapping with a boxplot was used because the variables are continuous, and this was able to show both the distribution of values, the spread, and median for each group. The White and Black groups have the largest sample sizes, which explains their denser clusters. Median cholesterol values are fairly similar across races, clustering around 5 mmol/L, though the Other group’s median appears slightly lower. Hispanic participants show the widest spread (largest IQR), suggesting more variation in cholesterol levels, while Mexican and Asian groups have smaller spreads. Overall, cholesterol levels are relatively consistent across racial groups. Together, these plots suggest that while BMI and cholesterol levels don’t differ drastically across income or race, small differences in variability may point to underlying social or health factors. Further analysis could investigate whether gender, age, or lifestyle factors such as diet and smoking explain these subtle patterns.


## 4. To what extent is education associated with the age when participants first begin smoking or using marijuana regularly, and does this vary by gender?
```{r, fig.width=8}
# Filtering data 
nhanes_clean2 <- NHANESraw |> 
  select(ID, Gender, SmokeAge, AgeRegMarij, Education) |> 
  na.omit() |>
  mutate(
    SmokeAgeGroup = cut(SmokeAge, breaks=c(0,14,17,20,100), labels=c("<15","15-17","18-20","21+")),
    MarijAgeGroup = cut(AgeRegMarij, breaks=c(0,14,17,20,100), labels=c("<15","15-17","18-20","21+"), include.lowest = TRUE)
  )
```

```{r, fig.width=8}
## Smoking vs Education faceted by Gender
ggplot(nhanes_clean2, aes(x=Education, fill=SmokeAgeGroup)) +
  geom_bar(position="dodge") + facet_wrap(~Gender) +
  labs(title="Age Started Smoking by Education and Gender",
       x="Education Level", y="Number of Participants", fill="Age Group", 
       caption = str_wrap("Source: NHANESraw. Age participants began smoking cigarettes regularly, grouped by education level and gender. Across both males and females, most started smoking between ages 15–17. The highest counts appear among those with a high school or some college education. College graduates also show smoking initiation around 15–17, but in smaller numbers. Males generally have higher counts, likely due to a larger sample size.", width=80)) + coord_flip()
```

```{r, fig.width=8}
## Marijuana vs Education faceted by Gender
ggplot(nhanes_clean2, aes(x=Education, fill=MarijAgeGroup)) +
  geom_bar(position="dodge") + facet_wrap(~Gender) +
  labs(title="Age Started Marijuana Use by Education and Gender",
       x="Education Level", y="Number of Participants", fill="Age Group", 
       caption = str_wrap("Source: NHANESraw. Age participants began using marijuana, grouped by education level and separated by gender. Similar to previous graph where most participants begin using between ages 15 and 17, with the highest counts among those with a high school education or some college. Male participants generally have higher counts, particularly among those in high school, while females show the highest counts in the 15–17 age group for both high school and some college. For college graduates, initiation is slightly later, peaking around 18–20.", width=80)) + coord_flip()
```

- To analyze the relationship between the age participants first used cigarettes or used marijuana and education, selected variables included education, gender, SmokeAge, and AgeRegMarij, removing any missing values. Age variables were grouped into categories (<15, 15–17, 18–20, 21+) to help simplify the visualization and highlight trends across age ranges. Bar charts were chosen because they effectively display the distribution of a subgroup across categories. In this case, two discrete variables are grouped by a third discrete variable, and dodge-positioned bars allow for direct comparison of age groups within each education level. The plots were faceted by gender to explore potential differences between males and females. Across both cigarettes and marijuana, most participants started between ages 15–17, with high frequencies for individuals with a high school education or some college. College graduates also report starting in this age range, but in smaller numbers. Male participants generally have higher frequencies, particularly in the high school category, while females show the highest counts for some college education. For cigarette and marijuana use, the 8th grade education level has <15 age group as the highest bar. Very early smoking age (<15) is more common for cigarette use than marijuana where the <15 age group is the second-highest age group in some college, high school, and 9th–11th grade groups. For marijuana, the <15 age group is lower across all education levels, indicating that fewer participants start marijuana use very early compared to cigarettes. Overall, the age participants first used cigarettes or used marijuana began in mid-teens (15–17). Among these, males typically finished high school, while females most often reached some college. Future analysis could focus on how these patterns relate to health outcomes later in life. It could also explore whether starting age correlates with race or socioeconomic status.


